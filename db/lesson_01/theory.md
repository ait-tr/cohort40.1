# Основы реляционных БД

**Система управления базами данных, СУБД** — специальная программа-сервер позволяющая использовать и управлять базами данных. СУБД позволяет читать и записывать данные, искать по ним и выполнять сложные выборки.

## База данных

**БД** — фактически создаваемые на диске файлы, в которых хранится информация записанная с помощью СУБД

**Важно!**
Часто значение БД и СУБД путают, можно услышать фразу “БД PostgreSQL” когда имелось ввиду “СУБД PostgreSQL”

## Что такое СУБД?

**Реляционная система управления базами данных, СУБД / Database Management System (DBMS)** — СУБД которая хранит данные в виде таблиц и строк в этих таблицах.
Примеры СУБД:

- MySQL
- PostgreSQL
- MSSQL
- Oracle

## PostgreSQL

_SQL_ - язык структурированных запросовStructured Query Language

**SQL** — декларативный язык программирования, предназначенный для описания, изменения и извлечения данных из СУБД. Чаще всего используется в реляционных СУБД.

### Таблица, строка, столбец

- _Таблица_ — совокупность строк и столбцов
- _Строка_ — запись в БД о конкретной сущности
- _Столбец_ — любой атрибут сущности хранящейся в строке

### Типы данных: числовые

- `serial` — целое с автоувеличением, от 1 до 2147483647
- `smallint`, `int2` — целое, от -32768 до +32767;
- `integer`, `int`, `int4` — целое, от -2147483648 до +2147483647
- `bigint`, `int8` — целое, от -9 223 372 036 854 775 808 до 9 223 372 036 854 775 807
- `double precision`, `float8` — с плавающей точкой, от 1E-307 до 1E+308

### Типы данных: стоковые

- `character(n)`, `char(n)` — представляет строку из фиксированного количества символов. С помощью параметра задается задается количество символов в строке

- `character varying(n)`, `varchar(n)` - представляет строку из фиксированного количества символов. С помощью параметра задается задается количество символов в строке
- `text` — представляет текст произвольной длины

### Типы данных: время и даты

- `timestamp` — хранит дату и время, с учётом часового пояса или без. Для дат самое нижнее значение 4713 год до н. э., самое верхнее значение 294276 год н. э.
- `date` — представляет дату от 4713 год до н. э. до 5874897 года н.э
- `time` — хранит время суток, без даты, с учётом часового пояса или без. Принимает значения от 00:00:00 до 24:00:00

### Типы данных: прочие

- `boolean` — булево значение, true или false
- `jsonb` — данные произвольного формата в формате JSON

## SQL: создание пользователя СУБД

```sql
CREATE USER test_user WITH PASSWORD 'qwerty';
```

Пользователь создаётся именно в СУБД!

## SQL: создание базы данных

```sql
CREATE DATABASE test_db OWNER test_user
```

Любая база должна быть создана, прежде чем к ней можно будет подключиться.
Пользователь, указанный как owner, будет иметь максимальные права доступа к этой базе данных.

## SQL: права пользователя в БД

```sql
GRANT ALL PRIVILEGES ON DATABASE test_db TO test_user;
```

По умолчанию доступ к базе имеет только owner и супер-администратор СУБД. Всем остальным пользователям доступ нужно добавлять явным образом.

## SQL: удаление базы данных

```sql
DROP DATABASE test_db;
```

Удалить базу данных может её владелец, супер-администратор СУБД или пользователь, которому явным образом даны на это права.

## SQL: создание таблицы

```sql
CREATE TABLE students (
id serial PRIMARY KEY, name varchar(80), age integer
);
```


## SQL: добавление строк в таблицу

```sql
INSERT INTO students (name, age) VALUES
('Anna', 25),
('Maria', 23),
('Roman', 28);
```

Обратите внимание, что поле id существует в таблице, но указывать его значение не обязательно. Тип данных serial позволяет ему заполняться автоматически.

## SQL: извлечение данных

```sql
SELECT * FROM students;
SELECT name, age FROM students;
SELECT * FROM students WHERE age < 18;
SELECT * FROM students ORDER BY age ASC;
SELECT AVG(age) AS 'Средний возраст' FROM students;
```

С помощью `SELECT` можно не просто вытаскивать данные, но и проводить фильтрацию, сортировать и проводить несложные агрегации.

## SQL: изменение данных

```sql
UPDATE students SET age = 26 WHERE name = 'Anna';
```

С помощью `UPDATE` можно изменять любые данные в таблице.
Использование `WHERE` не обязательно, хотя и крайне рекомендуется. Без `WHERE` будут обновлены все существующие строчки в таблице.

## SQL: удаление данных

```sql
DELETE FROM students WHERE id = 1;
```

Чаще всего удаление происходит по `id`, но можно удалять и по любому другому полю:

```sql
DELETE FROM students WHERE name = 'Anna';
```

Возможно использование DELETE вообще без WHERE, в таком случае будут удалены вообще все данные в таблице.
